(this.webpackJsonpsmartmessage=this.webpackJsonpsmartmessage||[]).push([[0],{201:function(t,e,n){},217:function(t,e){},242:function(t,e){},244:function(t,e){},322:function(t,e){},324:function(t,e){},356:function(t,e){},361:function(t,e){},363:function(t,e){},370:function(t,e){},383:function(t,e){},462:function(t,e,n){},464:function(t,e,n){"use strict";n.r(e);var a=n(27),s=n.n(a),r=n(101),i=n.n(r),c=(n(201),n(18)),o=n.n(c),u=n(60),l=n(6),p=n(8),h=n(12),g=n(11),d=(n(203),n(194)),b=n.n(d),m=(n(462),[{constant:!0,inputs:[],name:"messageCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"messages",outputs:[{internalType:"string",name:"sentFrom",type:"string"},{internalType:"string",name:"sentTo",type:"string"},{internalType:"string",name:"content",type:"string"},{internalType:"string",name:"hashToken",type:"string"},{internalType:"uint256",name:"id",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"messagesArray",outputs:[{internalType:"string",name:"sentFrom",type:"string"},{internalType:"string",name:"sentTo",type:"string"},{internalType:"string",name:"content",type:"string"},{internalType:"string",name:"hashToken",type:"string"},{internalType:"uint256",name:"id",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"string",name:"_sentFrom",type:"string"},{internalType:"string",name:"_sentTo",type:"string"},{internalType:"string",name:"_content",type:"string"},{internalType:"string",name:"_hashToken",type:"string"}],name:"createMessage",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"string",name:"_hashToken",type:"string"}],name:"getChatLength",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"string",name:"_hashToken",type:"string"}],name:"getMessages",outputs:[{internalType:"string[]",name:"",type:"string[]"},{internalType:"string[]",name:"",type:"string[]"},{internalType:"string[]",name:"",type:"string[]"},{internalType:"uint256[]",name:"",type:"uint256[]"}],payable:!1,stateMutability:"view",type:"function"}]),y=n(7),f=function(t){var e=t.message,n=t.index,a=t.messages;return Object(y.jsx)("div",{children:Object(y.jsxs)("p",{children:[e,": ",a[2][n]]})})},j=function(){return Object(y.jsx)("nav",{class:"navbar navbar-expand-lg navbar-dark bg-dark",children:Object(y.jsxs)("div",{class:"container-fluid",children:[Object(y.jsx)("a",{class:"navbar-brand",href:"#",children:"Smart Messenger"}),Object(y.jsx)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(y.jsx)("span",{class:"navbar-toggler-icon"})}),Object(y.jsx)("div",{class:"collapse navbar-collapse",id:"navbarNav",children:Object(y.jsxs)("ul",{class:"navbar-nav",children:[Object(y.jsx)("li",{class:"nav-item",children:Object(y.jsx)("a",{class:"nav-link active","aria-current":"page",href:"#",children:"Home"})}),Object(y.jsx)("li",{class:"nav-item",children:Object(y.jsx)("a",{class:"nav-link",href:"#",children:"About"})})]})})]})})},v=function(t){Object(h.a)(n,t);var e=Object(g.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).state={account:"",messageList:void 0,messages:{0:[]},toSend:"",user:"",targetUser:"",chatHash:""},a}return Object(p.a)(n,[{key:"componentWillMount",value:function(){this.loadBlockchainData()}},{key:"decrypt",value:function(){var t=Object(u.a)(o.a.mark((function t(e,n){var a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=function(t){return t.split("").map((function(t){return t.charCodeAt(0)}))},s=function(t){return a(e).reduce((function(t,e){return t^e}),t)},t.abrupt("return",n.match(/.{1,2}/g).map((function(t){return parseInt(t,16)})).map(s).map((function(t){return String.fromCharCode(t)})).join(""));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"loadBlockchainData",value:function(){var t=Object(u.a)(o.a.mark((function t(){var e,n,a,s,r,i,c,u,l,p,h,g,d,y;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return function(t,e){var n=function(t){return t.split("").map((function(t){return t.charCodeAt(0)}))};return e.split("").map(n).map((function(e){return n(t).reduce((function(t,e){return t^e}),e)})).map((function(t){return("0"+Number(t).toString(16)).substr(-2)})).join("")},e=function(t,e){return e.match(/.{1,2}/g).map((function(t){return parseInt(t,16)})).map((function(e){return(n=t,n.split("").map((function(t){return t.charCodeAt(0)}))).reduce((function(t,e){return t^e}),e);var n})).map((function(t){return String.fromCharCode(t)})).join("")},n=new b.a("http://108.29.140.197:7545"),t.next=5,n.eth.getAccounts();case 5:return a=t.sent,this.setState({account:a[0]}),s=new n.eth.Contract(m,"0x8EbF6Fe4732a4843A268da0CE4592B7C10652B11"),this.setState({messageList:s}),console.log("HELLO",s.methods),t.next=12,s.methods.messageCount().call();case 12:return r=t.sent,t.next=15,s.methods.getChatLength(this.state.chatHash).call();case 15:if(i=t.sent,console.log("Chat length",i),this.setState({chatCount:i}),this.setState({messageCount:r}),""==this.state.chatHash){t.next=42;break}return(c=[this.state.user,this.state.targetUser]).sort(),c=c[0]+c[1],t.next=25,s.methods.getMessages(c).call();case 25:u=t.sent,l=u[2],p=[],h=0;case 29:if(!(h<l.length)){t.next=37;break}return t.next=32,e(this.state.encryption,l[h]);case 32:g=t.sent,p.push(g);case 34:h++,t.next=29;break;case 37:d={0:u[0],1:u[1],2:p,3:u[3]},this.setState({chatCount:p.length}),this.setState({messages:d}),(y=document.getElementById("messages")).scrollTop=y.scrollHeight;case 42:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addOne",value:function(){var t=Object(u.a)(o.a.mark((function t(){var e,n,a,s=this;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=function(t,e){var n=function(t){return t.split("").map((function(t){return t.charCodeAt(0)}))};return e.split("").map(n).map((function(e){return n(t).reduce((function(t,e){return t^e}),e)})).map((function(t){return("0"+Number(t).toString(16)).substr(-2)})).join("")},(n=[this.state.user,this.state.targetUser]).sort(),a=e(this.state.encryption,this.state.toSend),n=n[0]+n[1],this.state.messageList.methods.createMessage(this.state.user,this.state.targetUser,a,n).send({from:this.state.account,gas:3e6}).once("receipt",function(){var t=Object(u.a)(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.loadBlockchainData(),document.getElementById("message").value="",console.log(e);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),console.log("sent");case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return Object(y.jsxs)("div",{children:[Object(y.jsx)(j,{}),Object(y.jsxs)("div",{className:"container",children:[Object(y.jsx)("h1",{children:"Smart Messenger"}),Object(y.jsx)("p",{children:"A peer-to-peer encrypted messaging service that only uses blockchain to transfer and store encrypted messages."}),Object(y.jsxs)("div",{class:"input-group mb-3",children:[Object(y.jsx)("span",{class:"input-group-text",id:"basic-addon1",children:Object(y.jsx)("i",{class:"fas fa-key"})}),Object(y.jsx)("input",{type:"text",class:"form-control",placeholder:"Encryption Key","aria-label":"Encryption Key","aria-describedby":"basic-addon1",onChange:function(e){t.setState({encryption:e.target.value})}})]}),Object(y.jsxs)("div",{class:"input-group mb-3",children:[Object(y.jsx)("span",{class:"input-group-text",id:"basic-addon1",children:"@"}),Object(y.jsx)("input",{type:"text",class:"form-control",placeholder:"Your username","aria-label":"Your username","aria-describedby":"basic-addon1",onChange:function(e){t.setState({user:e.target.value,chatHash:t.state.user+t.state.targetUser})}})]}),Object(y.jsxs)("div",{class:"input-group mb-3",children:[Object(y.jsx)("span",{class:"input-group-text",id:"basic-addon1",children:"@"}),Object(y.jsx)("input",{type:"text",class:"form-control",placeholder:"Target username","aria-label":"Target username","aria-describedby":"basic-addon1",onChange:function(e){t.setState({targetUser:e.target.value,chatHash:t.state.user+t.state.targetUser})}})]}),Object(y.jsxs)("p",{children:["Total chats: ",this.state.messageCount]}),Object(y.jsxs)("p",{children:["Your chats: ",this.state.chatCount]}),Object(y.jsx)("div",{id:"messages",style:{width:"auto",height:"400px",overflowX:"hidden",overflowY:"auto"},children:this.state.messages[0].map((function(e,n){return Object(y.jsx)(f,{message:e,index:n,messages:t.state.messages})}))}),Object(y.jsxs)("div",{class:"row g-2",children:[Object(y.jsx)("textarea",{class:"form-control",id:"message",rows:"3",onChange:function(e){t.setState({toSend:e.target.value})},placeholder:"Aa"}),Object(y.jsx)("button",{type:"button",class:"btn btn-primary",onClick:this.addOne.bind(this),children:Object(y.jsx)("i",{class:"fas fa-paper-plane"})}),Object(y.jsxs)("button",{type:"button",class:"btn btn-success",onClick:this.loadBlockchainData.bind(this),children:[Object(y.jsx)("i",{class:"fas fa-sync"}),"Refresh chat"]})]}),Object(y.jsx)("br",{})]})]})}}]),n}(a.Component),x=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,468)).then((function(e){var n=e.getCLS,a=e.getFID,s=e.getFCP,r=e.getLCP,i=e.getTTFB;n(t),a(t),s(t),r(t),i(t)}))};i.a.render(Object(y.jsx)(s.a.StrictMode,{children:Object(y.jsx)(v,{})}),document.getElementById("root")),x()}},[[464,1,2]]]);
//# sourceMappingURL=main.4052c276.chunk.js.map